<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>测试工作台</title>
    <style>
      body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background: #0b1220; color: #e6e6e6; }
      header { padding: 12px 16px; background: #111827; border-bottom: 1px solid #1f2937; display: flex; align-items: center; justify-content: space-between; }
      h1 { margin: 0; font-size: 16px; }
      .toolbar { display: flex; gap: 8px; align-items: center; }
      button { padding: 6px 10px; border: 1px solid #334155; background: #1f2937; color: #e6e6e6; border-radius: 6px; cursor: pointer; }
      button:hover { background: #374151; }
      .container { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 12px; }
      .card { border: 1px solid #1f2937; background: #0f172a; border-radius: 8px; padding: 10px; }
      .card h2 { margin: 0 0 8px; font-size: 14px; color: #9ca3af; }
      textarea { width: 100%; min-height: 120px; background: #0b1020; color: #e6e6e6; border: 1px solid #334155; border-radius: 6px; padding: 8px; }
      pre { white-space: pre-wrap; word-break: break-word; background: #0b1020; padding: 8px; border-radius: 6px; border: 1px solid #334155; }
      .status { font-size: 12px; color: #94a3b8; }
      .row { display: flex; gap: 10px; align-items: center; }
      .sep { height: 1px; background: #1f2937; margin: 8px 0; }
      label { font-size: 13px; color: #94a3b8; }
      .log { max-height: 180px; overflow: auto; font-size: 12px; }
    </style>
  </head>
  <body>
    <header>
      <h1>测试工作台</h1>
      <div class="toolbar">
        <button data-action="e">执行</button>
        <input type="checkbox" value="c" id="continueRunning" /><label for="continueRunning"> 连续运行</label>
        <button data-action="s">跳过</button>

        <button id="btnSave">保存到文件</button>
        <button data-action="q">退出</button>
      </div>
    </header>
    <div class="container">
      <section class="card">
        <h2>当前步骤</h2>
        <div class="status" id="stepStatus">等待加载…</div>
        <pre id="stepAction"></pre>
        <div class="sep"></div>
        <div class="row">
          <label><input type="checkbox" id="autoAddOnSuccess" /> 自动将成功的自然语言/脚本添加为步骤</label>
        </div>
        <div class="sep"></div>
        <div class="row">
          <label><input type="radio" name="mode" value="nl" checked /> 自然语言</label>
          <label><input type="radio" name="mode" value="script" /> Stagehand 脚本</label>
          <button id="sendCustom">发送</button>
          <button id="addFromInput">添加步骤</button>
        </div>
        <textarea id="customText" placeholder="输入自然语言或脚本…"></textarea>
      </section>

      <section class="card">
        <h2>翻译与执行</h2>
        <div class="row"><label>匹配规则:</label><span id="rule"></span></div>
        <div class="row"><label>匹配模式:</label><span id="pattern"></span></div>
        <div class="sep"></div>
        <h2>发送脚本</h2>
        <pre id="scriptOut"></pre>
        <div class="sep"></div>
      </section>

      <section class="card">
        <h2>测试步骤管理</h2>
        <div class="row">
          <label class="status">文件:</label><span id="fileName" class="status"></span>
          <span id="dirtyFlag" class="status"></span>
        </div>
        <div class="row">
          <label class="status">版本:</label>
          <select id="versionList"></select>
          <button id="btnCheckout">回滚到版本</button>
        </div>
        <div id="steps" class="log"></div>
      </section>
      <section class="card">
        <h2>上次翻译与执行</h2>
        <div class="row"><label>匹配规则:</label><span id="ruleLast"></span></div>
        <div class="row"><label>匹配模式:</label><span id="patternLast"></span></div>
        <div class="sep"></div>
        <h2>上次发送脚本</h2>
        <pre id="scriptOutLast"></pre>
        <div class="sep"></div>
        <h2>上次返回结果</h2>
        <pre id="resultOutLast"></pre>
      </section>
      <section class="card" style="grid-column: 1 / span 2">
        <h2>日志</h2>
        <div class="log" id="log"></div>
      </section>
    </div>

    <script src="/client.js"></script>
  </body>
</html>